(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["x-24"],{"35dd":function(t,e,i){"use strict";i.r(e);var s,a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("dwd-page",{attrs:{"is-header":""}},[i("form",{staticClass:"order-refund"},[t.product.skuName?i("div",{staticClass:"prod-box"},[i("img",{staticClass:"prod-img",attrs:{src:t.product.imgUrl}}),i("div",{staticClass:"prod-right"},[i("div",{staticClass:"prod-name max-line-2"},[t._v(t._s(t.product.skuName))]),t._l(t.product.attrs,(function(e,s){return i("div",{key:s,staticClass:"prod-attrs"},[t._v(t._s(e))])}))],2)]):t._e(),i("div",{staticClass:"content"},[i("div",{staticClass:"refund-style"},[i("div",{staticClass:"refund style-title"},[t._v("处理方式:")]),i("div",{staticClass:"refund refund-value",attrs:{"data-refundmothod":t.refundMethod}},[t._v(t._s(t.refundMethodName))])]),i("div",{staticClass:"refund-reason",on:{click:t.initActionsheet}},[i("div",{staticClass:"reason-content"},[i("div",{staticClass:"refund reason-title"},[t._v("退款原因:")]),t.reason?i("div",{staticClass:"refund refund-value",attrs:{"data-reasonid":t.reasonId}},[t._v(t._s(t.reason))]):i("div",{staticClass:"refund refund-value"},[t._v("请选择退款原因")])]),i("div",{staticClass:"right"},[i("img",{staticClass:"right-link",attrs:{src:"https://img1.haoshiqi.net/wxapp/img/more_85508a3b09.png"}})])]),t.product.pay_price?i("div",{staticClass:"refund-style refund-money"},[i("div",{staticClass:"refund style-title"},[t._v("退款金额:")]),i("div",{staticClass:"refund refund-value"},[t._v("￥"+t._s(t.product.pay_price))])]):t._e(),i("div",{staticClass:"refund-explain"},[i("div",{staticClass:"explain"},[i("div",{staticClass:"refund explain-title"},[t._v("退款说明:")]),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.comment,expression:"comment"}],staticClass:"refund refund-textarea",staticStyle:{"min-height":"17px","line-height":"16px","font-size":"12px",color:"rgbrgb(153, 153, 153)"},attrs:{placeholder:"最多可填写500个字",maxlength:"500"},domProps:{value:t.comment},on:{input:function(e){e.target.composing||(t.comment=e.target.value)}}})])]),i("div",{staticClass:"refund-img"},[i("div",{staticClass:"img-title",class:{"is-required":"AFTER_SALES"===t.salesRefundType}},[i("span",{staticClass:"upload-title"},[t._v("最多可上传3张")]),i("span",{staticClass:"upload-rule"},[t._v("（建议产品照片、内包装盒照片、含快递单的外包装箱照片各一张）")])]),i("div",{staticClass:"upload-img"},[t._l(t.imageList,(function(e,s){return i("div",{key:s},[i("div",{staticClass:"img-view",on:{click:function(i){return t.previewImage(e)}}},[i("img",{staticClass:"img",attrs:{src:e}}),i("div",{staticClass:"clear-icon",on:{click:function(e){return e.stopPropagation(),t.clearImage(s)}}},[i("dwd-icon",{attrs:{type:"delete",size:"16",color:"#999",bg:"#fff"}})],1)])])})),t.imageList.length<t.imageMax?i("div",{staticClass:"upload",on:{click:t.uploadImage}},[i("div",{staticClass:"line1"}),i("div",{staticClass:"line2"})]):t._e(),i("input",{ref:"upload-img",staticClass:"file-input",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*",multiple:""},on:{change:t.uploadChange}})],2)])]),i("button",{staticClass:"submit",class:{"submit-ok":t.reason},on:{click:function(e){return e.preventDefault(),t.formSubmit(e)}}},[t._v("提交")])]),t.showBigPic?i("div",{staticClass:"big-pic",on:{click:t.hideBigPic}},[i("img",{staticClass:"big-pic-img",attrs:{src:t.currentSrc}})]):t._e(),i("mt-actionsheet",{attrs:{actions:t.refundReason},model:{value:t.sheetVisible,callback:function(e){t.sheetVisible=e},expression:"sheetVisible"}})],1)},n=[],r=(i("ac6a"),i("5df3"),i("bd86")),o=(i("7f7f"),i("0b29"),i("c705")),d=i.n(o),u=i("ed08"),c=i("035f"),l=i("f8cb"),f=[],h={domain:"https://img2.haoshiqi.net/"},m={components:(s={},Object(r["a"])(s,d.a.name,d.a),Object(r["a"])(s,c["a"].name,c["a"]),s),data:function(){return{isLoading:!0,imageList:[],imageMax:3,showBigPic:!1,imgUrl:"",product:{pay_price:0},refundMethodName:"",refundMethod:"",refundReason:[],salesRefundType:"",sheetVisible:!1,reason:"",reasonId:0,comment:"",currentSrc:""}},computed:{subOrderId:function(){return this.$route.query.subOrderId},orderId:function(){return this.$route.query.orderId}},created:function(){this.getRefundInit()},methods:{getSubOrderInfo:function(){var t=this,e=this.subOrderId||"";e&&this.$api.subOrderInfo({subOrderId:e},(function(e){var i={imgUrl:e.data.sku_thumbnail||e.data.skuThumbnail,skuName:e.data.sku_name,attrs:e.data.attrs_desc,pay_price:Object(u["a"])(e.data.pay_price)};t.product=Object.assign({},t.product,i)}),(function(t){}))},getRefundInit:function(){var t=this,e=this.orderId||"",i=this.subOrderId||"";e?(this.isLoading=!0,this.$api.refundInit({weights:1,orderId:e,subOrderId:i},(function(e){var i=e.data;t.isLoading=!1,t.refundMethodName=i.refundMethodList[0].name,t.refundMethod=i.refundMethodList[0].id,t.refundReason=i.reasonList,t.salesRefundType=i.salesRefundType,t.getSubOrderInfo()}),(function(t){}))):this.$showToast("参数order_id错误")},initActionsheet:function(){var t=this;this.sheetVisible=!0,this.refundReason.map((function(e){return e.method=t.chooseReason}))},chooseReason:function(t){var e=t.name,i=t.id;this.reason=e,this.reasonId=i},uploadImage:function(){this.$refs["upload-img"].click()},getImageCount:function(){var t=this.imageMax-this.imageList.length;return t>0?t:0},uploadChange:function(t){var e=this;f=t.target.files||[];var i=this.imageList.length+f.length;if(i>this.imageMax)return this.$refs["upload-img"].value="",void this.$showToast("最多允许上传".concat(this.imageMax,"张"));for(var s=0;s<f.length;s++){var a=new FileReader;a.readAsDataURL(f[s]),a.onload=function(t){e.imageList.push(t.target.result)}}},previewImage:function(t){this.showBigPic=!0,this.currentSrc=t},hideBigPic:function(){this.showBigPic=!1},clearImage:function(t){this.imageList.splice(t,1)},formSubmit:function(t){var e=this;this.reason?"AFTER_SALES"===this.salesRefundType&&this.imageList.length<=0?this.$showToast("请上传图片！"):this.$showConfirm({title:"提示",message:"确认提交？",confirmButtonText:"确定",cancelButtonText:"取消",callback:function(t){"cancel"!=t&&"error"!=t&&e.upload()}}):this.$showToast("请选择退款原因！")},upload:function(){var t=this;h.token?this.uploadQiniu():this.$api.getQiniuToken({},(function(e){h.token=e.data.token,t.uploadQiniu()}),(function(e){t.$showToast("获取图片上传权限失败，请重新操作")}))},uploadFile:function(t){var e=this;return new Promise((function(i,s){var a=new FormData;a.append("file",t),Object(l["a"])(h.token,a).then((function(t){var e=t.data,s=h.domain+e.hash+"?imageView2/0/q/70";i(s)})).catch((function(t){s(new Error("上传失败")),e.$showConfirm({title:"错误",message:"上传失败"})}))}))},uploadQiniu:function(){for(var t=this,e=f,i=[],s=0;s<e.length;s++)i.push(this.uploadFile(e[s]));Promise.all(i).then((function(e){t.afterUploadedImg(e)}),(function(t){}))},afterUploadedImg:function(t){var e=this,i=t.length>0?JSON.stringify(t):"",s=this.orderId||"",a=this.subOrderId||"";this.$api.refundApply({orderId:s,subOrderId:a,refundMethod:this.refundMethod,reasonId:this.reasonId,comment:this.comment,pics:i},(function(t){var i=t.data.refundInfo.id;e.goRefundDetail(i)}),(function(t){}))},goRefundDetail:function(t){this.$forward("order-refund-detail",{refundId:t,replace:!0})}}},p=m,g=(i("8d20"),i("2877")),v=Object(g["a"])(p,a,n,!1,null,"a11710ee",null);e["default"]=v.exports},"3a0f":function(t,e,i){},"8d20":function(t,e,i){"use strict";var s=i("3a0f"),a=i.n(s);a.a}}]);