(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["x-21"],{"5dfd":function(e,t,n){"use strict";n.r(t);var s,a,o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("dwd-page",{attrs:{"is-header":""}},[n("div",{staticClass:"order-page",class:{"order-page-pb":!e.showFooterIndex}},[e.msgStatus?n("div",{staticClass:"scroll-view-border"},[n("div",{staticClass:"msg-img-box"},[n("img",{staticClass:"msg-img",attrs:{src:"https://img1.haoshiqi.net/miniapp/horn_9d0f9ebd2c.png"}})]),n("div",{staticClass:"msg-content-box"},[n("div",{staticClass:"srcoll-view"},[e._v(e._s(e.msgContent.content||""))])])]):e._e(),n("div",{staticClass:"banner"},[e.orderInfo.statusLogo?n("img",{staticClass:"logo",attrs:{src:e.orderInfo.statusLogo,alt:""}}):e._e(),n("div",{staticClass:"state-box"},[n("div",{staticClass:"state"},[e._v(e._s(e.orderInfo.status||e.orderInfo.statusDesc))]),e.orderInfo.canPay?n("div",{staticClass:"countdown"},[e._v(e._s(e.countDownInfo))]):e._e()])]),n("div",{staticClass:"user-info-box"},[n("div",{staticClass:"user-name-phone",class:{"phone-cost":16===e.orderInfo.order_type}},[n("div",{staticClass:"user-name"},[e._v(e._s(e.orderInfo.consignee))]),n("div",{staticClass:"user-phone"},[e._v(e._s(e.orderInfo.phone))])]),n("div",{staticClass:"user-address"},[e._v(e._s(e.orderInfo.address))])]),n("div",{staticClass:"main-content"},[n("div",{staticClass:"prod-box"},[e.isGat?n("div",{staticClass:"prod-mc",attrs:{"data-link":e.orderInfo.schema},on:{click:e.$onUrlPage}},[n("img",{staticClass:"prod-mc-logo",attrs:{src:"https://img1.haoshiqi.net/miniapp/img/merchant_icon_25a2d95ce6.png"}}),n("div",{staticClass:"prod-mc-name"},[e._v(e._s(e.orderInfo.merchantName))])]):e._e(),e._l(e.productDesc,(function(t,s){return n("div",{key:s,staticClass:"prod-item",attrs:{"data-link":t.schema},on:{click:e.$onUrlPage}},[n("img",{staticClass:"prod-item-img",attrs:{src:t.imgUrl}}),n("div",{staticClass:"prod-item-right"},[n("div",{staticClass:"prod-item-name max-line-2"},[e._v(e._s(t.skuName))]),n("div",{staticClass:"prod-item-info"},[n("span",{staticClass:"price"},[e._v("￥"+e._s(t.price))]),n("span",{staticClass:"num"},[e._v("x"+e._s(t.amount))])]),e._l(t.attrs,(function(t,s){return n("div",{key:s,staticClass:"prod-item-attrs"},[e._v(e._s(t))])})),n("div",{staticClass:"prod-item-btns"},[t.canRefund?n("div",{staticClass:"prod-btn",on:{click:function(n){return n.stopPropagation(),e.goRefund(t.orderId,t.subOrderId)}}},[e._v("申请退款")]):e._e(),t.refundId>0?n("div",{staticClass:"prod-btn prod-btn-red",attrs:{"data-suborderid":t.subOrderId,"data-orderstatus":t.status,"data-refundid":t.refundId},on:{click:function(n){return n.stopPropagation(),e.goRefundDetail(t.refundId)}}},[e._v(e._s(t.refundStatus))]):e._e()])],2)])}))],2),n("div",{staticClass:"msg-box"},[n("div",{staticClass:"msg-title"},[e._v("买家留言：")]),n("div",{staticClass:"msg-content"},[e._v(e._s(e.orderInfo.note))])]),n("div",{staticClass:"amount-box"},[e._l(e.priceDesc,(function(t,s){return n("div",{key:s,staticClass:"amount-item"},[n("span",[e._v(e._s(t.name))]),n("span",{staticClass:"amount-item-vaule"},[e._v(e._s(t.icon+t.value))])])})),n("div",{staticClass:"amount-item amount-real"},[n("span",[e._v("实付款")]),n("span",{staticClass:"amount-real-val"},[e._v("￥"+e._s(e.orderInfo.needPayPrice))])])],2)]),n("div",{staticClass:"main-content"},[n("div",{staticClass:"order-msg"},[n("div",{staticClass:"order-num"},[e._v("\n          订单号："+e._s(e.orderInfo.id)+"\n          "),n("div",{staticClass:"order-num-copy",on:{click:e.handleCopy}},[e._v("复制")])]),e._l(e.orderInfo.stepList,(function(t,s){return n("div",{key:s,staticClass:"order-time"},[e._v("\n          "+e._s(t)+"\n        ")])}))],2),n("div",{staticClass:"mc-btns"},[n("div",{staticClass:"mc-btn"},[n("div",{staticClass:"mc-btn-txt mc-btn-l",on:{click:e.makePhoneCall}},[e._v("联系卖家")])]),n("div",{staticClass:"mc-btn"},[n("div",{staticClass:"mc-btn-txt mc-btn-r",on:{click:e.goService}},[e._v("在线客服")])])])]),1==e.showFooterIndex?[1==e.orderInfo.statusCode&&e.orderInfo.savePrice?n("div",{staticClass:"save-money"},[e._v("付款后即节省￥"+e._s(e.orderInfo.savePrice))]):e._e(),e.orderInfo.hasBottom?n("div",{staticClass:"order-footer"},[e.orderInfo.canConfirm?n("div",{staticClass:"btn-normal btn-red",on:{click:e.confirmReceipt}},[e._v("确认收货")]):e._e(),e.orderInfo.canPay?n("div",{staticClass:"btn-normal btn-red",on:{click:e.payOrder}},[e._v("付款")]):e._e(),e.orderInfo.canCancel?n("div",{staticClass:"btn-normal",on:{click:e.goCancelOrder}},[e._v("取消订单")]):e._e(),e.orderInfo.canRefund?n("div",{staticClass:"btn-normal",on:{click:function(t){return e.goRefund(e.orderInfo.id,void 0,e.orderInfo.needPayPrice)}}},[e._v("申请退款")]):e._e(),e.orderInfo.refundId?n("div",{staticClass:"btn-normal btn-red",on:{click:function(t){return e.goRefundDetail(e.orderInfo.refundId)}}},[e._v("退款详情")]):e._e(),e.orderInfo.canViewDelivery?n("div",{staticClass:"btn-normal",on:{click:e.goDelivery}},[e._v("查看物流")]):e._e()]):e._e()]:2==e.showFooterIndex?[e.orderInfo.pinStatusDesc?n("div",{staticClass:"div-share"},[1==e.orderInfo.coupleStatus?[n("button",{staticClass:"btn-share",attrs:{"open-type":"share"}},[e._v(e._s(e.orderInfo.pinStatusDesc))])]:[n("button",{staticClass:"btn-share",on:{click:e.onLotterList}},[e._v(e._s(e.orderInfo.pinStatusDesc))])]],2):e._e()]:e._e()],2),n("mt-actionsheet",{attrs:{actions:e.cancelActions},model:{value:e.sheetVisible,callback:function(t){e.sheetVisible=t},expression:"sheetVisible"}})],1)},i=[],r=(n("ac6a"),n("bd86")),c=(n("7f7f"),n("0b29"),n("c705")),d=n.n(c),l=n("4f9d"),u=n("a499"),f=n("ed08"),m=n("51be"),v={name:"order-detail",components:Object(r["a"])({},d.a.name,d.a),data:function(){return{isLoading:!0,msgStatus:!1,orderInfo:{savePrice:"",phone:"",address:"",needPayPrice:""},productDesc:[],priceDesc:[],leftTime:0,countDownInfo:"",sheetVisible:!1,cancelActions:[],msgContent:"",isGat:!m["a"].isChannel("guanaitong")}},computed:{orderId:function(){return this.$route.query.id},showFooterIndex:function(){var e=0;switch(this.orderInfo.coupleStatus){case 1:e=this.orderInfo.canPay||this.orderInfo.canCancel?1:2;break;case 3:case 4:e=2;break;default:this.orderInfo.hasBottom&&(e=1);break}return e}},created:function(){this.refresh()},beforeDestroy:function(){this.clearPageData()},methods:{refresh:function(){var e={orderId:this.orderId};this.isLoading=!0,this.getData(e)},getData:function(e){var t=this;this.$api.orderDetail(Object.assign({},e,{weights:1}),(function(e){var n=e.data;t.orderInfo=Object.assign({},t.orderInfo,n),t.dealOrderInfo(n),s=e.timestamp,a=n.created_at+3600;var o=n.message&&n.message.end_time||0;1e3*a>s&&n.canPay&&t.countDown(),s<o&&(t.msgStatus=!0,t.msgContent=n.message||{}),t.productDesc=[],n.skuList&&t.dealSku(n.skuList),t.dealPrise(n),t.isLoading=!1}),(function(e){}))},dealOrderInfo:function(e){var t=e.deliveryCity||e.delivery_city,n=e.delivery_province;n+=t+e.delivery_district,n+=e.delivery_detail_address;var s={};s={canPay:e.canPay||!1,canCancel:e.canCancel||!1,canRefund:e.canRefund&&1===e.delivery_status,canViewDelivery:e.canViewDelivery||!1,canConfirm:e.canConfirm||!1,refundId:e.refundId||0,note:e.note||"无留言",savePrice:Object(f["a"])(e.saved_money),phone:e.consigneePhone||e.consignee_phone,needPayPrice:Object(f["a"])(e.need_pay_price),address:n,consignee:16===this.orderInfo.order_type?"充值手机号":this.orderInfo.consignee},s.hasBottom=s.canPay||s.canCancel||s.canRefund||s.refundId>0||s.canViewDelivery||s.canConfirm,this.orderInfo=Object.assign({},this.orderInfo,s)},dealSku:function(e){var t=this;e.forEach((function(e){var n=Object(f["a"])(e.unit_price);t.productDesc.push({subOrderId:e.id,pinId:e.pin_activities_id||t.orderInfo.pin_activities_id,skuId:e.sku_id,skuName:e.sku_name,imgUrl:e.skuThumbnail,price:n,amount:e.amount,attrs:e.attrs_desc,schema:e.schema,orderId:e.order_id,status:e.status,refundId:e.refundId,canRefund:e.subCanRefund,refundStatus:e.refundStatusDesc||"退款详情"})}))},dealPrise:function(e){this.priceDesc=[],this.priceDesc.push({name:"商品总额",value:Object(f["a"])(e.productsPrice),icon:"￥"}),this.priceDesc.push({name:"运费",value:Object(f["a"])(e.delivery_price),icon:"+￥"}),e.merchant_discount=e.merchant_discount||0,this.priceDesc.push({name:"商家优惠",value:Object(f["a"])(e.merchant_discount),icon:"-￥"}),e.platform_discount=e.platform_discount||0,this.priceDesc.push({name:"平台优惠",value:Object(f["a"])(e.platform_discount),icon:"-￥"})},countDown:function(){var e=this,t=1e3*s-+new Date,n=1e3*a+t;this.countDownManger=new u["a"]({times:1e3,dataList:[{}],set:function(){n-new Date>0?this.start():e.leftTime=0},callback:function(){var t=n-new Date;if(t>0){var s=Object(l["a"])(t,"F分S秒");e.countDownInfo="剩余".concat(s,"自动关闭")}else e.countDownInfo="剩余00分00秒自动关闭",this.clear()}})},goRefund:function(e,t,n){this.$forward("order-refund",{orderId:e,subOrderId:t,refundPrice:n})},goRefundDetail:function(e){this.$forward("order-refund-detail",{refundId:e})},goCancelOrder:function(){var e=this.orderInfo.id;this.sheetVisible=!0,this.cancelActions=[{name:"我不想买了",method:this.cancelOrder,reason:1,orderId:e},{name:"信息填写错误",method:this.cancelOrder,reason:2,orderId:e},{name:"商品停售或缺货",method:this.cancelOrder,reason:3,orderId:e},{name:"其他原因",method:this.cancelOrder,reason:4,orderId:e}]},cancelOrder:function(e){var t=this,n=e.reason,s=e.orderId;e.clickIndex;this.$showLoading({content:"订单正在取消..."}),this.$api.orderCancel({orderId:s,reason:n},(function(e){t.$hideLoading(),setTimeout((function(){t.$showToast("订单取消成功")}),500),setTimeout((function(){t.countDownManger&&t.countDownManger.clear(),t.getData({orderId:s})}),1e3)}),(function(e){t.$showToast("订单取消失败")}))},payOrder:function(){var e=this.orderInfo,t=e.orderId,n=e.orderType,s=e.need_pay_price,a=e.pin_activities_id,o=(this.orderInfo.pinCountLimit||0)-(this.orderInfo.pinJoinCount||0)==1;this.$forward("".concat(window.location.origin,"/index.html#order_pay?orderIds=").concat(t,"&lastJoinCouple=").concat(o,"&price=").concat(s,"&pinActivitiesId=").concat(a,"&orderType=").concat(n))},goDelivery:function(){var e=this.orderInfo,t=e.orderId,n=e.deliveryWay,s=2==n?"order_delivery2b":"order_delivery";this.$forward("".concat(window.location.origin,"/index.html#").concat(s,"?orderid=").concat(t))},confirmReceipt:function(){var e=this,t=this.orderInfo.id;this.$showConfirm({title:"确认已经收到货了吗？",message:"请务必在已收货的情况下进行确认！",confirmButtonText:"确认收货",cancelButtonText:"取消",callback:function(n){"cancel"!=n&&"error"!=n&&(e.$showLoading(),e.$api.confirmReceived({orderId:t},(function(n){e.$hideLoading(),setTimeout((function(){e.$showToast("确认收货成功！")}),1e3),setTimeout((function(){e.getData({orderId:t})}),2e3)}),(function(t){e.$showToast("确认收货失败")})))}})},clearPageData:function(){this.countDownManger&&this.countDownManger.clear()},onLotterList:function(){var e=this.orderInfo.orderType;2==e||3==e?this.forward("index",{}):4!=e&&5!=e||this.forward("lottery-list",{})},handleCopy:function(){var e=document.createElement("input");document.body.appendChild(e),e.setAttribute("value",this.orderInfo.id),e.select(),document.execCommand("copy"),e.style.display="none",this.$showToast("复制成功")},makePhoneCall:function(){window.location.href="tel://"+(this.orderInfo.serviceTel||"")},goService:function(){location.href=window.location.origin+"/index.html#service"}}},h=v,p=(n("e809"),n("2877")),_=Object(p["a"])(h,o,i,!1,null,"67ad1558",null);t["default"]=_.exports},"96bc":function(e,t,n){},e809:function(e,t,n){"use strict";var s=n("96bc"),a=n.n(s);a.a}}]);